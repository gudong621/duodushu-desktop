# 多读书 (Duodushu) 桌面客户端 - 产品需求文档 (PRD)

**版本**: 1.0
**日期**: 2026-01-29
**基于项目**: Duodushu Web (v1.0)
**架构方案**: Electron + Next.js + Python (FastAPI)

---

## 1. 产品概述

### 1.1 产品定位

**多读书桌面版** 是一款**本地优先（Local-First）且支持绿色便携（Portable）**的沉浸式英语学习工作站。它继承了 Web 版本的所有核心阅读与 AI 辅助功能，提供更强大的性能、更便捷的系统集成和完全离线的数据掌控能力。

**核心价值主张**：
- **绿色便携 (Portable)**：支持解压即用，不写注册表，学习数据（书籍、笔记、词典）可随软件目录整体移动。
- **私有化与安全**：所有数据存储于本地设备或软件目录下，无需上传云端。
- **高性能阅读**：利用本地文件系统，秒开数百 MB 的 PDF/EPUB 大文件。
- **系统级集成**：支持全局快捷键、文件关联（双击打开）、系统通知。

### 1.2 目标用户

与 Web 版一致，但更侧重于：
- **“绿色软件”爱好者**：喜欢解压即用，追求系统纯净，希望数据随身携带的用户。
- **深度学习者**：需要长时间沉浸阅读，通过本地应用避免浏览器干扰。
- **隐私敏感用户**：不希望将私人书籍上传到第三方服务器。
- **离线办公/学习人群**：在弱网环境下仍需查阅本地资料和笔记。

---

## 2. 功能差异化矩阵 (Web vs Desktop)

| 功能模块 | Web 版 | 桌面版 (Electron) | 备注 |
| :--- | :--- | :--- | :--- |
| **部署方式** | 需服务器部署/Docker | **免安装解压即用 (.zip/.7z)** | 支持双击 exe 直接运行 |
| **数据存储** | 服务器 SQLite/Docker 卷 | **软件目录下 /data (便携模式)** | 支持全量迁移 |
| **离线能力** | 依赖服务器连通性 | **完全本地运行** | 仅 AI API 需联网 |
| **文件关联** | 不支持 | **支持双击 .epub/.pdf 打开** | 系统级集成 |
| **快捷键** | 仅限浏览器焦点内 | **支持全局快捷键** | 如：全局唤起查词窗口 |
| **AI 引擎** | 服务器端配置 | **用户自定义 API Key** | 支持用户填写自己的 Key |

---

## 3. 功能详细需求 (新增/变更部分)

*注：未列出的功能（如阅读器、AI 对话、单词本）需求与《Web 版 PRD v1.0》保持一致。*

### 3.1 分发与启动

#### 3.1.1 绿色免安装版 (Portable)
**需求描述**：
- 提供压缩包（.zip/.7z），解压后包含 `duodushu.exe`。
- 点击直接运行，不需要管理员权限。
- 所有依赖（Python 等）静默包含在内。

#### 3.1.2 存储策略 (便携优先)
**需求描述**：
- **默认便携模式**：软件启动时检查同级目录下是否存在 `data/` 文件夹。如果存在，则将所有数据库、书籍文件存储在软件目录内。
- **数据迁移**：用户只需拷贝整个文件夹到新电脑，即可无损恢复所有阅读记录和生词。

### 3.2 文件管理增强

#### 3.2.1 本地书架
**需求描述**：
- **不再需要“上传”动作**。用户点击“添加书籍”是建立文件索引，而非物理复制文件（可选“复制到库”或“链接文件”）。
- 支持拖拽文件/文件夹到主窗口直接打开。
- 能够扫描指定文件夹下的所有支持格式书籍。

#### 3.2.2 系统文件关联
**需求描述**：
- 将 `.epub` 和特定格式文件的默认打开方式关联到“多读书”。
- 在文件管理器中双击文件，直接启动应用并跳转到阅读页。

### 3.3 系统集成

#### 3.3.1 系统托盘
**需求描述**：
- 支持最小化到系统托盘。
- 托盘菜单：打开主界面、快速查词、退出、设置。

#### 3.3.2 原生菜单与快捷键
**需求描述**：
- 注册原生应用菜单（File, Edit, View, Help）。
- 快捷键支持：
  - `Ctrl/Cmd + O`: 打开文件
  - `Ctrl/Cmd + F`: 全文/页内搜索
  - `Ctrl/Cmd + ,`: 设置

### 3.4 离线与网络策略

#### 3.4.1 混合在线模式
**需求描述**：
- **基础功能（离线）**：阅读、本地词典（ECDICT/MDX）、笔记、本地搜索、书签。
- **增强功能（联网）**：AI 老师、AI 翻译、TTS（若使用在线版）。
- **网络状态检测**：断网时自动降级，禁用 AI 按钮并提示“网络不可用”，但不影响阅读。

---

## 4. 非功能性需求

### 4.1 性能
- **启动速度**：冷启动（含 Python 后端初始化） < 5秒。
- **内存占用**：主进程 + 渲染进程 + Python 进程总和 < 800MB（空闲时）。

### 4.2 更新机制
- **自动更新**：检测 GitHub Releases 或 S3 存储桶的新版本。
- **增量更新**：支持 electron-updater 进行后台下载、重启安装。

### 4.3 安全性
- **API Key 加密**：用户的 API Key 必须加密存储在 OS 级的安全存储区（如 Windows Credential Manager, macOS Keychain），禁止明文保存。

---

## 5. 版本规划

### 5.1 v1.0 Desktop (MVP)
- 核心架构搭建：Electron + Next.js + Python 打包。
- 复用 Web 版所有阅读功能。
- 本地 SQLite 数据库集成。
- 基础的安装包生成。

### 5.2 v1.1 系统融合
- 文件关联支持。
- 自动更新支持。
- 性能优化（启动速度）。

### 5.3 v2.0 高级特性
- 本地向量库（替换 FTS5 或作为增强），利用用户 GPU 进行本地 AI 运算（如本地 LLM 模型）。
- 多窗口支持（同时打开多本书）。

---
**文档结束**
